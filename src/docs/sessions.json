{
  "paths": {
    "/api/v1/sessions": {
      "post": {
        "tags": ["Sessions"],
        "summary": "Create a new session",
        "description": "Book a therapy session between a patient and therapist. Patients can book sessions for themselves, and therapists can also create sessions.",
        "operationId": "createSession",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["patientId", "therapistId", "scheduledAt"],
                "properties": {
                  "patientId": {
                    "type": "string",
                    "format": "objectId",
                    "example": "507f1f77bcf86cd799439011",
                    "description": "Patient's user ID"
                  },
                  "therapistId": {
                    "type": "string",
                    "format": "objectId",
                    "example": "507f1f77bcf86cd799439012",
                    "description": "Therapist's user ID"
                  },
                  "scheduledAt": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2025-11-25T14:00:00.000Z",
                    "description": "Scheduled date and time for the session (must be in the future)"
                  },
                  "duration": {
                    "type": "integer",
                    "minimum": 15,
                    "default": 60,
                    "example": 60,
                    "description": "Session duration in minutes"
                  },

                  "sessionFee": {
                    "type": "number",
                    "minimum": 0,
                    "example": 1500,
                    "description": "Session fee (defaults to therapist's session rate)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Session created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or scheduling conflict",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Patients can only book for themselves",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Therapist profile not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "409": {
            "description": "Scheduling conflict - Therapist has another session at this time",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Sessions"],
        "summary": "Get all sessions with filters",
        "description": "Retrieve sessions with filtering and pagination. Patients see only their sessions, therapists see their sessions, and admins see all sessions.",
        "operationId": "getAllSessions",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "patientId",
            "in": "query",
            "schema": { "type": "string", "format": "objectId" },
            "description": "Filter by patient ID (admin only)"
          },
          {
            "name": "therapistId",
            "in": "query",
            "schema": { "type": "string", "format": "objectId" },
            "description": "Filter by therapist ID (admin only)"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["scheduled", "completed", "cancelled", "no-show"]
            },
            "description": "Filter by session status"
          },

          {
            "name": "paymentStatus",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "paid", "refunded"]
            },
            "description": "Filter by payment status"
          },
          {
            "name": "startDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled after this date"
          },
          {
            "name": "endDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled before this date"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": { "type": "string", "default": "-scheduledAt" },
            "description": "Sort field (prefix with - for descending)"
          },
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "default": 1 },
            "description": "Page number"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "maximum": 100, "default": 10 },
            "description": "Items per page"
          }
        ],
        "responses": {
          "200": {
            "description": "Sessions fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "sessions": {
                              "type": "array",
                              "items": { "$ref": "#/components/schemas/Session" }
                            },
                            "pagination": { "$ref": "#/components/schemas/Pagination" }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Not authorized to view sessions",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}": {
      "get": {
        "tags": ["Sessions"],
        "summary": "Get session by ID",
        "description": "Retrieve a specific session by its ID. Only accessible by the patient, therapist, or admin.",
        "operationId": "getSessionById",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Session fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Not authorized to view this session",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Sessions"],
        "summary": "Update session details",
        "description": "Update a scheduled session's details. Only the patient or therapist involved can update.",
        "operationId": "updateSession",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "scheduledAt": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2025-11-26T15:00:00.000Z",
                    "description": "New scheduled date and time"
                  },
                  "duration": {
                    "type": "integer",
                    "minimum": 15,
                    "example": 90,
                    "description": "New session duration in minutes"
                  },

                  "meetingLink": {
                    "type": "string",
                    "example": "https://meet.example.com/xyz-abc",
                    "description": "Meeting link for online sessions"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Can only update scheduled sessions or invalid time",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Not authorized to update this session",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "409": {
            "description": "Scheduling conflict with new time",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Sessions"],
        "summary": "Delete a session",
        "description": "Permanently delete a session from the database. Admin only.",
        "operationId": "deleteSession",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Session deleted successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiResponse" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Admin access required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/patient/my-sessions": {
      "get": {
        "tags": ["Sessions"],
        "summary": "Get my patient sessions",
        "description": "Retrieve all sessions for the logged-in patient with filtering and pagination.",
        "operationId": "getMyPatientSessions",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["scheduled", "completed", "cancelled", "no-show"]
            },
            "description": "Filter by session status"
          },
          {
            "name": "startDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled after this date"
          },
          {
            "name": "endDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled before this date"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": { "type": "string", "default": "-scheduledAt" },
            "description": "Sort field (prefix with - for descending)"
          },
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "default": 1 },
            "description": "Page number"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "maximum": 100, "default": 10 },
            "description": "Items per page"
          }
        ],
        "responses": {
          "200": {
            "description": "Patient sessions fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "sessions": {
                              "type": "array",
                              "items": { "$ref": "#/components/schemas/Session" }
                            },
                            "pagination": { "$ref": "#/components/schemas/Pagination" }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Patient role required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/therapist/my-sessions": {
      "get": {
        "tags": ["Sessions"],
        "summary": "Get my therapist sessions",
        "description": "Retrieve all sessions for the logged-in therapist with filtering and pagination.",
        "operationId": "getMyTherapistSessions",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["scheduled", "completed", "cancelled", "no-show"]
            },
            "description": "Filter by session status"
          },
          {
            "name": "startDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled after this date"
          },
          {
            "name": "endDate",
            "in": "query",
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter sessions scheduled before this date"
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": { "type": "string", "default": "-scheduledAt" },
            "description": "Sort field (prefix with - for descending)"
          },
          {
            "name": "page",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "default": 1 },
            "description": "Page number"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "minimum": 1, "maximum": 100, "default": 10 },
            "description": "Items per page"
          }
        ],
        "responses": {
          "200": {
            "description": "Therapist sessions fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "sessions": {
                              "type": "array",
                              "items": { "$ref": "#/components/schemas/Session" }
                            },
                            "pagination": { "$ref": "#/components/schemas/Pagination" }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Therapist role required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}/cancel": {
      "post": {
        "tags": ["Sessions"],
        "summary": "Cancel a session",
        "description": "Cancel a scheduled session. Can be done by either the patient or therapist.",
        "operationId": "cancelSession",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "cancellationReason": {
                    "type": "string",
                    "maxLength": 500,
                    "example": "Emergency came up, need to reschedule",
                    "description": "Reason for cancellation"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session cancelled successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Session already cancelled or completed",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Not authorized to cancel this session",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}/complete": {
      "post": {
        "tags": ["Sessions"],
        "summary": "Mark session as completed",
        "description": "Mark a scheduled session as completed. Only the therapist can do this.",
        "operationId": "completeSession",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Session marked as completed",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Can only complete scheduled sessions",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Only therapist can mark session as completed",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}/no-show": {
      "post": {
        "tags": ["Sessions"],
        "summary": "Mark session as no-show",
        "description": "Mark a scheduled session as no-show when patient doesn't attend. Only the therapist can do this.",
        "operationId": "markNoShow",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Session marked as no-show",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Can only mark scheduled sessions as no-show",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Only therapist can mark session as no-show",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}/notes": {
      "put": {
        "tags": ["Sessions"],
        "summary": "Add or update therapist notes",
        "description": "Add or update notes for a session. Only the assigned therapist can add notes.",
        "operationId": "addTherapistNotes",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["therapistNotes"],
                "properties": {
                  "therapistNotes": {
                    "type": "string",
                    "maxLength": 5000,
                    "example": "Patient showed significant progress in managing anxiety. Discussed coping strategies and homework assignments for next session.",
                    "description": "Session notes from the therapist"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Therapist notes added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Therapist notes are required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Only assigned therapist can add notes",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/{id}/payment": {
      "put": {
        "tags": ["Sessions"],
        "summary": "Update payment status",
        "description": "Update the payment status of a session. Can be done by admin or the patient.",
        "operationId": "updatePaymentStatus",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string", "format": "objectId" },
            "description": "Session ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["paymentStatus"],
                "properties": {
                  "paymentStatus": {
                    "type": "string",
                    "enum": ["pending", "paid", "refunded"],
                    "example": "paid",
                    "description": "New payment status"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": { "$ref": "#/components/schemas/Session" }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Valid payment status required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "403": {
            "description": "Forbidden - Not authorized to update payment status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          },
          "404": {
            "description": "Session not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/patient/statistics": {
      "get": {
        "tags": ["Sessions"],
        "summary": "Get patient session statistics",
        "description": "Retrieve session statistics for the logged-in patient including total sessions, completed sessions, total spending, and attendance rate.",
        "operationId": "getPatientStatistics",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Statistics fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "totalSessions": {
                              "type": "integer",
                              "example": 25
                            },
                            "completedSessions": {
                              "type": "integer",
                              "example": 20
                            },
                            "cancelledSessions": {
                              "type": "integer",
                              "example": 3
                            },
                            "scheduledSessions": {
                              "type": "integer",
                              "example": 2
                            },
                            "totalSpending": {
                              "type": "number",
                              "example": 30000
                            },
                            "attendanceRate": {
                              "type": "string",
                              "example": "80.00"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Patient role required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sessions/therapist/statistics": {
      "get": {
        "tags": ["Sessions"],
        "summary": "Get therapist session statistics",
        "description": "Retrieve session statistics for the logged-in therapist including total sessions, completed sessions, total revenue, and completion rate.",
        "operationId": "getTherapistStatistics",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Statistics fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "totalSessions": {
                              "type": "integer",
                              "example": 150
                            },
                            "completedSessions": {
                              "type": "integer",
                              "example": 130
                            },
                            "cancelledSessions": {
                              "type": "integer",
                              "example": 10
                            },
                            "scheduledSessions": {
                              "type": "integer",
                              "example": 5
                            },
                            "noShowSessions": {
                              "type": "integer",
                              "example": 5
                            },
                            "totalRevenue": {
                              "type": "number",
                              "example": 195000
                            },
                            "completionRate": {
                              "type": "string",
                              "example": "86.67"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Therapist role required",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ApiError" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Session": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId",
            "example": "507f1f77bcf86cd799439011"
          },
          "patientId": {
            "oneOf": [
              { "type": "string", "format": "objectId" },
              { "$ref": "#/components/schemas/UserBasic" }
            ]
          },
          "therapistId": {
            "oneOf": [
              { "type": "string", "format": "objectId" },
              { "$ref": "#/components/schemas/UserBasic" }
            ]
          },
          "scheduledAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-25T14:00:00.000Z"
          },
          "duration": {
            "type": "integer",
            "example": 60,
            "description": "Duration in minutes"
          },
          "status": {
            "type": "string",
            "enum": ["scheduled", "completed", "cancelled", "no-show"],
            "example": "scheduled"
          },
          "sessionType": {
            "type": "string",
            "default": "video",
            "example": "video",
            "description": "Session type (always video)"
          },
          "meetingLink": {
            "type": "string",
            "nullable": true,
            "example": "https://meet.example.com/xyz-abc"
          },
          "therapistNotes": {
            "type": "string",
            "nullable": true,
            "maxLength": 5000,
            "example": "Patient showed progress..."
          },
          "sessionFee": {
            "type": "number",
            "example": 1500
          },
          "paymentStatus": {
            "type": "string",
            "enum": ["pending", "paid", "refunded"],
            "example": "pending"
          },
          "cancellationReason": {
            "type": "string",
            "nullable": true,
            "maxLength": 500,
            "example": "Emergency came up"
          },
          "cancelledBy": {
            "oneOf": [
              { "type": "string", "format": "objectId" },
              { "$ref": "#/components/schemas/UserBasic" },
              { "type": "null" }
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-21T10:00:00.000Z"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-21T10:30:00.000Z"
          }
        }
      },
      "UserBasic": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "format": "objectId"
          },
          "fullName": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "phoneNumber": {
            "type": "string"
          }
        }
      }
    }
  }
}
